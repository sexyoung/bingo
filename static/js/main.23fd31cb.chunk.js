(this.webpackJsonpbingo=this.webpackJsonpbingo||[]).push([[0],{133:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),s=n(65),o=n.n(s),i=(n(79),n(13)),r=n(3),l=n(11),u=n(66),d=n(67),j={Denied:"RoomDenied",PlayerJoin:"RoomPlayerJoin",PlayerUpdate:"RoomPlayerUpdate",UpdateProcess:"RoomUpdateProcess",MessageSend:"RoomMessageSend",MessageUpdate:"RoomMessageUpdate",CountDown:"RoomCountDown",CountDownStop:"RoomCountDownStop",CountDownEnd:"RoomCountDownEnd",CountDownCancel:"RoomCountDownCancel",StartGame:"RoomStartGame",SaveMatrix:"RoomSaveMatrix",TriggerCountDown:"RoomTriggerCountDown",TriggerStartGame:"RoomTriggerStartGame"},h={ChangeName:"UserChangeName"},m={GoJoin:"GameGoJoin",RePlay:"GameRePlay",CheckNum:"GameCheckNum",SelfMatrix:"GameSelfMatrix",FetchMatrix:"GameFetchMatrix",UpdateChecked:"GameUpdateChecked"},b=[].concat(Object(l.a)(Object(l.a)(Array(10).keys()).map((function(e){return e+48}))),Object(l.a)(Object(l.a)(Array(26).keys()).map((function(e){return e+65})))),f=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="",n=0;n<e;n++)t+=String.fromCharCode(b[~~(b.length*Math.random())]);return t},O=function(){function e(t){var n;Object(u.a)(this,e);var a=localStorage.getItem("bingoUser");a||(a=JSON.stringify({name:"Player",id:this.getGUID()}),localStorage.setItem("bingoUser",a));var c=JSON.parse(a);for(var s in c)this[s]=c[s];this.socket=t,null===(n=this.socket)||void 0===n||n.on("connected",(function(e){console.warn("socketID connected: ",e)}))}return Object(d.a)(e,[{key:"save",value:function(){for(var e={},t=Object.keys(this).filter((function(e){return!["socket","room","matrix"].includes(e)})),n=0;n<t.length;n++)e[t[n]]=this[t[n]];localStorage.setItem("bingoUser",JSON.stringify(e))}},{key:"getGUID",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="",n=0;n<e;n++)t+=f(),n%8===7&&(t+="-");return t.slice(0,t.length-1)}},{key:"join",value:function(e){this.socket.emit(j.PlayerJoin,e,JSON.parse(localStorage.getItem("bingoUser")))}},{key:"send",value:function(e,t){this.socket.emit(j.MessageSend,e,t)}},{key:"updateProcess",value:function(e,t){this.socket.emit(j.UpdateProcess,e,t)}},{key:"changeName",value:function(e,t){this.name=t,this.save(),this.socket.emit(h.ChangeName,e,t)}},{key:"startCountDown",value:function(e){this.socket.emit(j.TriggerCountDown,e)}},{key:"startGame",value:function(e,t,n){this.socket.emit(j.TriggerStartGame,e,t,n)}},{key:"countDownCancel",value:function(e){this.socket.emit(j.CountDownCancel,e)}},{key:"saveMatrix2Server",value:function(e,t){this.socket.emit(j.SaveMatrix,e,t)}},{key:"checked",value:function(e,t){this.checkedList||(this.checkedList=[]),this.checkedList=Object(l.a)(new Set([].concat(Object(l.a)(this.checkedList),[t]))).sort((function(e,t){return e-t})),this.socket.emit(m.CheckNum,e,t)}},{key:"fetchMatrix",value:function(e){this.socket.emit(m.FetchMatrix,e)}},{key:"replay",value:function(e){this.socket.emit(m.RePlay,e)}},{key:"leave",value:function(){null===this||void 0===this||this.socket.close()}}]),e}(),_=n(6),x=n.n(_);function v(){var e=Object(r.f)(),t=Object(c.useRef)();return Object(a.jsxs)("div",{className:x.a.HomePage,children:[Object(a.jsxs)("div",{className:x.a.slogan,children:[Object(a.jsxs)("div",{className:x.a.ballGroup,children:[Object(a.jsx)("div",{className:x.a.ball,children:"B"}),Object(a.jsx)("div",{className:x.a.ball,children:"I"}),Object(a.jsx)("div",{className:x.a.ball,children:"N"}),Object(a.jsx)("div",{className:x.a.ball,children:"G"}),Object(a.jsx)("div",{className:x.a.ball,children:"O"})]}),Object(a.jsx)("div",{className:x.a.subTitle,children:"ONLINE BATTLE"})]}),Object(a.jsxs)("div",{className:x.a.menu,children:[Object(a.jsx)("button",{className:x.a.create,onClick:function(){e.replace("/".concat(f(4),"/join"))},children:"CREATE"}),Object(a.jsx)("h3",{children:"OR"}),Object(a.jsxs)("form",{onSubmit:function(n){n.preventDefault(),e.replace("/".concat(t.current.value,"/join"))},className:x.a.form,children:[Object(a.jsx)("input",{required:!0,type:"text",ref:t,maxLength:"4",pattern:"[0-9A-Z]{4}",placeholder:"ROOM ID"}),Object(a.jsx)("button",{children:"JOIN"})]})]}),Object(a.jsx)(i.b,{className:x.a.rule,to:"/rule",children:"HOW TO PLAY"})]})}var y=n(22),p=n(5),g=n(73),k=n(10),N=n.n(k),C=n(30),w=n.n(C);function D(e){var t,n=this,c=e.data,s=e.onClick,o=e.isActive,i=e.className,r=void 0===i?"":i,l=e.checkedList,u=void 0===l?[]:l,d=function(e){o&&s(e)};return Object(a.jsx)("div",{className:N()(w.a.BingoMatrix,(t={},Object(p.a)(t,w.a.active,o),Object(p.a)(t,r,Boolean(r)),t)),children:c.map((function(e,t){return Object(a.jsx)("div",{className:N()(w.a.box,Object(p.a)({},w.a.checked,u.includes(c[t]))),onClick:d.bind(n,t),children:e},t)}))})}var M=n(14),S=n(69),P=n.n(S),R=n(2),L=n.n(R),G=0;function B(e){var t=e.user,n=function(e){var t=Object(c.createRef)(),n=Object(c.createRef)(),s=Object(r.f)(),o=Object(r.g)().room,i=Object(c.createRef)(),u=Object(c.useState)(5),d=Object(M.a)(u,2),h=d[0],m=(d[1],Object(c.createRef)([])),b=Object(c.useState)(""),f=Object(M.a)(b,2),O=f[0],_=f[1],x=Object(c.useState)(null),v=Object(M.a)(x,2),y=v[0],g=v[1],k=Object(c.useState)([]),C=Object(M.a)(k,2),w=C[0],D=C[1],S=Object(c.useState)(null),R=Object(M.a)(S,2),B=R[0],I=R[1],U=Object(c.useState)([]),E=Object(M.a)(U,2),J=E[0],T=E[1],q=Object(c.useState)(Array(Math.pow(h,2)).fill(0)),A=Object(M.a)(q,2),H=A[0],F=A[1],Y=function(t){console.warn("updateProcess"),e.matrix=t,e.updateProcess(o,t.filter((function(e){return e})).length/Math.pow(h,2))},z=function(e){G=e.filter((function(e){return e})).length,F(e),Y(e)},K=function(){var e=Object(l.a)(Array(Math.pow(h,2)).keys()).map((function(e){return e+1})).sort((function(){return.5-Math.random()}));z(e)},Q=function(){e.startGame(o,h,h)};return Object(c.useLayoutEffect)((function(){e.join(o),P.a.toDataURL("".concat(location.origin+location.pathname,"/#/").concat(o,"/join").replace("bingo//","bingo/"),{width:512,height:512},(function(e,t){if(e)return console.error(e);I(t)}));var t=function(e){return D(e.filter((function(e){return e})))},n=function(e){return T((function(t){return[].concat(Object(l.a)(t),[e])}))},a=function(){},c=function(e){g(e)},i=function(){g(null)},r=function(){e.save(),e.saveMatrix2Server(o,e.matrix),s.replace("/".concat(o,"/game"))};return e.socket.on(j.Denied,a),e.socket.on(j.PlayerUpdate,t),e.socket.on(j.MessageUpdate,n),e.socket.on(j.CountDown,c),e.socket.on(j.CountDownStop,i),e.socket.on(j.CountDownEnd,Q),e.socket.on(j.StartGame,r),K(),function(){e.socket.off(j.Denied,a),e.socket.off(j.CountDown,c),e.socket.off(j.PlayerUpdate,t),e.socket.off(j.MessageUpdate,n),e.socket.off(j.CountDown,c),e.socket.off(j.CountDownStop,i),e.socket.off(j.CountDownEnd,Q),e.socket.off(j.StartGame,r)}}),[]),Object(c.useEffect)((function(){console.warn("do it"),m.current.scrollTop=m.current.scrollHeight}),[J.length]),{show:O,size:h,count:y,matrix:H,qrcode64:B,userList:w,chatHistory:J,handleSubmit:function(t){t.preventDefault(),e.send(o,n.current.value),n.current.value="",_(""),n.current.blur()},handleRename:function(n){n.preventDefault(),t.current.value&&(e.changeName(o,t.current.value),_(""))},updateProcess:Y,handleStartCountDown:function(){e.startCountDown(o)},handleStartGame:Q,matrixProcess:z,resetMatrix:function(){var e=Array(Math.pow(h,2)).fill(0);z(e)},randomMatrix:K,handlePutNum:function(e){if(!H[e]){var t=Object(l.a)(H);t[e]=G+1,z(t)}},toggleShow:function(e){_(O===e?"":e)},handleCopyLink:function(){var e=document.createElement("input"),t=window.location.href;document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Copied!")},handleCountDownCancel:function(){e.countDownCancel(o)},CanvasDOM:Object(a.jsx)("canvas",{ref:i,id:"canvas",className:L.a.qrcode}),NameDOM:Object(a.jsx)("input",{required:!0,type:"text",ref:t,className:L.a.name,placeholder:"your name",defaultValue:e.name}),InputDOM:Object(a.jsx)("input",{type:"text",ref:n,placeholder:"\u8f38\u5165\u8a0a\u606f"}),ChatHistoryDOM:Object(a.jsx)("div",{className:L.a.chatHistory,ref:m,children:J.map((function(t,n){var c,s,o,i,r;return Object(a.jsx)("div",{className:N()(L.a.msgBox,(o={},Object(p.a)(o,L.a.isMe,e.id===t.user.id),Object(p.a)(o,L.a.same,t.user.id===(null===(c=J[n-1])||void 0===c||null===(s=c.user)||void 0===s?void 0:s.id)),o)),children:Object(a.jsxs)("div",{className:L.a.msg,children:[e.id!==t.user.id&&t.user.id!==(null===(i=J[n-1])||void 0===i||null===(r=i.user)||void 0===r?void 0:r.id)&&Object(a.jsx)("div",{className:L.a.name,children:t.user.name}),Object(a.jsx)("div",{className:L.a.text,children:t.text})]})},n)}))})}}(t),s=n.NameDOM,o=n.InputDOM,i=n.ChatHistoryDOM,u=Object(g.a)(n,["NameDOM","InputDOM","ChatHistoryDOM"]),d=Object(r.g)().room;return Object(a.jsxs)("div",{className:L.a.JoinPage,children:[Object(a.jsxs)("div",{className:L.a.header,children:[Object(a.jsx)("div",{className:L.a.qrcode,onClick:u.toggleShow.bind(this,"qrcode")}),Object(a.jsxs)("div",{className:L.a.playerCount,onClick:u.toggleShow.bind(this,"player"),children:[u.userList.length," Player"]}),Object(a.jsx)("div",{className:L.a.fit}),Object(a.jsx)("div",{className:L.a.userName,onClick:u.toggleShow.bind(this,"rename"),children:t.name}),Object(a.jsx)("div",{className:L.a.matrix,onClick:u.toggleShow.bind(this,"editor")})]}),Object(a.jsxs)("div",{className:L.a.content,children:[Object(a.jsx)("div",{className:N()([L.a.chatPane],Object(p.a)({},L.a.show,""===u.show)),children:i}),Object(a.jsx)("ul",{className:N()([L.a.playerPane],Object(p.a)({},L.a.show,"player"===u.show)),children:u.userList.map((function(e){return Object(a.jsxs)("li",{children:[Object(a.jsx)("div",{className:L.a.name,children:e.name}),Object(a.jsx)("div",{className:N()(L.a.percentage,Object(p.a)({},L.a.fin,1===e.percentage)),children:Object(a.jsx)("div",{className:L.a.bar,style:{width:"".concat(~~(100*e.percentage),"%")}})})]},e.id)}))}),Object(a.jsx)("div",{className:N()([L.a.renamePane],Object(p.a)({},L.a.show,"rename"===u.show)),children:Object(a.jsxs)("form",{onSubmit:u.handleRename,children:[s,Object(a.jsx)("button",{children:"Rename"})]})}),Object(a.jsxs)("div",{className:N()([L.a.editorPane],Object(p.a)({},L.a.show,"editor"===u.show)),children:[Object(a.jsx)(D,Object(y.a)({},{data:u.matrix,onClick:u.handlePutNum,isActive:!0})),Object(a.jsxs)("div",{className:L.a.buttons,children:[Object(a.jsx)("button",{className:L.a.reset,onClick:u.resetMatrix,children:"RESET"}),Object(a.jsx)("button",{className:L.a.random,onClick:u.randomMatrix,children:"RANDOM"})]})]}),Object(a.jsxs)("div",{className:N()([L.a.qrcodePane],Object(p.a)({},L.a.show,"qrcode"===u.show)),children:[Object(a.jsx)("img",{src:u.qrcode64,width:"100%"}),Object(a.jsx)("div",{className:L.a.roomID,children:d}),Object(a.jsx)("div",{className:L.a.link,onClick:u.handleCopyLink,children:"Copy the Link"})]})]}),Object(a.jsxs)("form",{className:L.a.sendMsgBar,onSubmit:u.handleSubmit,children:[!u.userList.findIndex((function(e){return e.id===t.id}))&&Object(a.jsx)("button",{type:"button",className:L.a.startBtn,onClick:u.handleStartCountDown,disabled:u.userList.some((function(e){var t=e.percentage;return 1!==(void 0===t?0:t)})),children:"Start"}),o,Object(a.jsx)("button",{type:"submit",className:L.a.sendBtn,children:"\u3000"})]}),null!==u.count&&Object(a.jsxs)("div",{className:N()(L.a.countdown),children:[u.count,Object(a.jsx)("button",{className:L.a.stopBtn,onClick:u.handleCountDownCancel,children:"CANCEL"})]})]})}var I=n(70),U=n.n(I),E=n(71),J=n.n(E);function T(){var e=Object(r.h)().path,t=Object(c.useMemo)((function(){return new O(U()("//bingo-ws.sexyoung.tw"))}),[]);return Object(c.useEffect)((function(){return function(){return t.leave()}}),[]),t?Object(a.jsx)("div",{className:J.a.RoomPage,children:Object(a.jsxs)(r.c,{children:[Object(a.jsx)(r.a,{path:"".concat(e,"/join"),children:Object(a.jsx)(B,Object(y.a)({},{user:t}))}),Object(a.jsx)(r.a,{path:"".concat(e,"/game"),children:Object(a.jsx)(Q,Object(y.a)({},{user:t}))}),Object(a.jsx)(r.a,{path:"*",children:Object(a.jsx)(Z,{})})]})}):null}var q=n(7),A=n.n(q),H=0,F=[],Y=[],z=[],K=function(e){var t=+e.split("").map((function(e){return e.charCodeAt()})).join(""),n=~~(t/24)%256,a=~~(t/25)%256;return"rgba(".concat(~~(t/23)%256,", ").concat(n,", ").concat(a,", .25)")};function Q(e){var t,n=e.user,s=Object(r.g)().room,o=Object(r.f)(),l=Object(c.useState)(""),u=Object(M.a)(l,2),d=u[0],h=u[1];Object(c.useLayoutEffect)((function(){var e=function(){n.leave(),o.push("/denied")},t=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],c=arguments.length>4?arguments[4]:void 0;Y=e,z=n,F=a,H=c,h(t)},a=function(e,a,c,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5?arguments[5]:void 0;n.matrix=e,t(a,c,s,o,i)},c=function(){o.replace("/".concat(s,"/join"))};return n.socket.on(j.Denied,e),n.socket.on(m.UpdateChecked,t),n.socket.on(m.SelfMatrix,a),n.socket.on(m.GoJoin,c),n.socket.connected?n.fetchMatrix(s):(n.join(s),n.socket.on(j.PlayerUpdate,(function e(){n.fetchMatrix(s),n.socket.off(j.PlayerUpdate,e)}))),function(){n.socket.off(m.GoJoin,c),n.socket.off(j.Denied,e),n.socket.off(m.SelfMatrix,a),n.socket.off(m.UpdateChecked,t)}}),[]);return(null===(t=n.matrix)||void 0===t?void 0:t.length)?Object(a.jsxs)("div",{className:A.a.GamePage,children:[Object(a.jsxs)("div",{className:A.a.winMap,children:[Object(a.jsx)("div",{className:A.a.start,children:"0"}),Object(a.jsx)("div",{className:A.a.way,children:z.map((function(e,t){return Object(a.jsxs)("div",{className:A.a.player,style:{zIndex:t,left:"".concat(e.winCount/H*100,"%")},children:[Object(a.jsx)("div",{className:A.a.nameColor,style:{backgroundColor:K(e.name)}}),e.name.slice(0,1)]},t)}))}),Object(a.jsx)("div",{className:A.a.end,children:H})]}),Object(a.jsx)("div",{className:A.a.gap,children:Boolean(F.length)&&Object(a.jsxs)("div",{className:A.a.result,children:[Object(a.jsxs)("div",{className:A.a.winList,children:[Object(a.jsx)("div",{className:A.a.winnerIs,children:"Winner is"}),Object(a.jsx)("span",{children:F.join(", ")})]}),Object(a.jsxs)("div",{className:A.a.buttons,children:[Object(a.jsx)("div",{onClick:function(){n.replay(s)},children:"Replay"}),Object(a.jsx)(i.b,{to:"/",children:"Home"})]})]})}),Object(a.jsx)(D,Object(y.a)({},{checkedList:Y,data:n.matrix,onClick:function(e){Y.includes(n.matrix[e])||n.checked(s,n.matrix[e])},className:A.a.Matrix,isActive:d===n.id&&!F.length}))]}):null}function W(){return Object(a.jsx)("div",{children:Object(a.jsx)("h2",{children:"DeniedPage"})})}function Z(){return Object(a.jsx)("div",{children:Object(a.jsx)("h2",{children:"NotFoundPage"})})}var X=n(72),V=n.n(X);var $=function(){return Object(c.useEffect)((function(){new O}),[]),Object(a.jsx)("div",{className:V.a.App,children:Object(a.jsx)(i.a,{children:Object(a.jsxs)(r.c,{children:[Object(a.jsx)(r.a,{exact:!0,path:"/",children:Object(a.jsx)(v,{})}),Object(a.jsx)(r.a,{path:"/denied",children:Object(a.jsx)(W,{})}),Object(a.jsx)(r.a,{path:"/:room",children:Object(a.jsx)(T,{})}),Object(a.jsx)(r.a,{path:"*",children:Object(a.jsx)(Z,{})})]})})})},ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,134)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),s(e),o(e)}))};o.a.render(Object(a.jsx)($,{}),document.getElementById("root")),ee()},2:function(e,t,n){e.exports={JoinPage:"style_JoinPage__1yRqt",header:"style_header__3tP8g",qrcode:"style_qrcode__1Ymzf",fit:"style_fit__3ueTB",playerCount:"style_playerCount__2ZlMH",userName:"style_userName__2FLYj",matrix:"style_matrix__3DhF3",content:"style_content__3hdnE",show:"style_show__1iKK8",playerPane:"style_playerPane__3aZLP",name:"style_name__1NsHE",percentage:"style_percentage__1IAjC",bar:"style_bar__WRKm2",fin:"style_fin__-vbWu",qrcodePane:"style_qrcodePane__2NTJq",roomID:"style_roomID__2pQSQ",link:"style_link__3kdmi",renamePane:"style_renamePane__1NFcr",editorPane:"style_editorPane__3dOQM",buttons:"style_buttons__1B8NJ",reset:"style_reset__1bZl_",chatHistory:"style_chatHistory__2fE-_",msgBox:"style_msgBox__oveu_",isMe:"style_isMe__3khzJ",same:"style_same__23AjY",msg:"style_msg__19tUv",text:"style_text__HUwxi",sendMsgBar:"style_sendMsgBar__qhnKV",startBtn:"style_startBtn__3y_kI",sendBtn:"style_sendBtn__1QmdX",countdown:"style_countdown__3tY60",stopBtn:"style_stopBtn__1zDc6"}},30:function(e,t,n){e.exports={BingoMatrix:"style_BingoMatrix__3ELFw",active:"style_active__2Nq_8",box:"style_box__3N-zJ",checked:"style_checked__xbBbd"}},6:function(e,t,n){e.exports={HomePage:"style_HomePage__39HyE",slogan:"style_slogan__3ESLi",ballGroup:"style_ballGroup__3Yrc5",ball:"style_ball__2mxKH",subTitle:"style_subTitle__1-Xg-",menu:"style_menu__2Jp3l",create:"style_create__2PDh_",form:"style_form__3edYN",rule:"style_rule__Cjqvv"}},7:function(e,t,n){e.exports={GamePage:"style_GamePage__3oB8L",winMap:"style_winMap__2EpiN",start:"style_start__3UEjd",way:"style_way__3TNYO",player:"style_player__1mIID",nameColor:"style_nameColor__haFkJ",end:"style_end__IFxsV",gap:"style_gap__3ZdYz",result:"style_result__3WXQ5",winList:"style_winList__OB6Xp",winnerIs:"style_winnerIs__8g5sy",buttons:"style_buttons__2R5Gl"}},71:function(e,t,n){},72:function(e,t,n){},79:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.23fd31cb.chunk.js.map