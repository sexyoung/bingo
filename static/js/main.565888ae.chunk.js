(this.webpackJsonpbingo=this.webpackJsonpbingo||[]).push([[0],{133:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),s=n(65),o=n.n(s),i=(n(79),n(13)),r=n(3),l=n(11),d=n(66),u=n(67),j={Denied:"RoomDenied",PlayerJoin:"RoomPlayerJoin",PlayerUpdate:"RoomPlayerUpdate",UpdateProcess:"RoomUpdateProcess",MessageSend:"RoomMessageSend",MessageUpdate:"RoomMessageUpdate",CountDown:"RoomCountDown",CountDownStop:"RoomCountDownStop",CountDownEnd:"RoomCountDownEnd",CountDownCancel:"RoomCountDownCancel",StartGame:"RoomStartGame",SaveMatrix:"RoomSaveMatrix",TriggerCountDown:"RoomTriggerCountDown",TriggerStartGame:"RoomTriggerStartGame"},h={ChangeName:"UserChangeName"},m={GoJoin:"GameGoJoin",RePlay:"GameRePlay",CheckNum:"GameCheckNum",SelfMatrix:"GameSelfMatrix",FetchMatrix:"GameFetchMatrix",UpdateChecked:"GameUpdateChecked"},b=[].concat(Object(l.a)(Object(l.a)(Array(10).keys()).map((function(e){return e+48}))),Object(l.a)(Object(l.a)(Array(26).keys()).map((function(e){return e+65})))),O=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="",n=0;n<e;n++)t+=String.fromCharCode(b[~~(b.length*Math.random())]);return t},_=function(){function e(t){var n;Object(d.a)(this,e);var a=localStorage.getItem("bingoUser");a||(a=JSON.stringify({name:"Player",id:this.getGUID()}),localStorage.setItem("bingoUser",a));var c=JSON.parse(a);for(var s in c)this[s]=c[s];this.socket=t,null===(n=this.socket)||void 0===n||n.on("connected",(function(e){}))}return Object(u.a)(e,[{key:"save",value:function(){for(var e={},t=Object.keys(this).filter((function(e){return!["socket","room","matrix"].includes(e)})),n=0;n<t.length;n++)e[t[n]]=this[t[n]];localStorage.setItem("bingoUser",JSON.stringify(e))}},{key:"getGUID",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="",n=0;n<e;n++)t+=O(),n%8===7&&(t+="-");return t.slice(0,t.length-1)}},{key:"join",value:function(e){this.socket.emit(j.PlayerJoin,e,JSON.parse(localStorage.getItem("bingoUser")))}},{key:"send",value:function(e,t){this.socket.emit(j.MessageSend,e,t)}},{key:"updateProcess",value:function(e,t){this.socket.emit(j.UpdateProcess,e,t)}},{key:"changeName",value:function(e,t){this.name=t,this.save(),this.socket.emit(h.ChangeName,e,t)}},{key:"startCountDown",value:function(e){this.socket.emit(j.TriggerCountDown,e)}},{key:"startGame",value:function(e,t,n){this.socket.emit(j.TriggerStartGame,e,t,n)}},{key:"countDownCancel",value:function(e){this.socket.emit(j.CountDownCancel,e)}},{key:"saveMatrix2Server",value:function(e,t){this.socket.emit(j.SaveMatrix,e,t)}},{key:"checked",value:function(e,t){this.checkedList||(this.checkedList=[]),this.checkedList=Object(l.a)(new Set([].concat(Object(l.a)(this.checkedList),[t]))).sort((function(e,t){return e-t})),this.socket.emit(m.CheckNum,e,t)}},{key:"fetchMatrix",value:function(e){this.socket.emit(m.FetchMatrix,e)}},{key:"replay",value:function(e){this.socket.emit(m.RePlay,e)}},{key:"leave",value:function(){null===this||void 0===this||this.socket.close()}}]),e}(),f=n(7),v=n.n(f);function x(){var e=Object(r.f)(),t=Object(c.useRef)();return Object(a.jsxs)("div",{className:v.a.HomePage,children:[Object(a.jsxs)("div",{className:v.a.slogan,children:[Object(a.jsxs)("div",{className:v.a.ballGroup,children:[Object(a.jsx)("div",{className:v.a.ball,children:"B"}),Object(a.jsx)("div",{className:v.a.ball,children:"I"}),Object(a.jsx)("div",{className:v.a.ball,children:"N"}),Object(a.jsx)("div",{className:v.a.ball,children:"G"}),Object(a.jsx)("div",{className:v.a.ball,children:"O"})]}),Object(a.jsx)("div",{className:v.a.subTitle,children:"ONLINE BATTLE"})]}),Object(a.jsxs)("div",{className:v.a.menu,children:[Object(a.jsx)("button",{className:v.a.create,onClick:function(){e.replace("/".concat(O(4),"/join"))},children:"CREATE"}),Object(a.jsx)("h3",{children:"OR"}),Object(a.jsxs)("form",{onSubmit:function(n){n.preventDefault(),e.replace("/".concat(t.current.value,"/join"))},className:v.a.form,children:[Object(a.jsx)("input",{required:!0,type:"text",ref:t,maxLength:"4",pattern:"[0-9A-Z]{4}",placeholder:"ROOM ID"}),Object(a.jsx)("button",{children:"JOIN"})]})]}),Object(a.jsx)(i.b,{className:v.a.rule,to:"/rule",children:"HOW TO PLAY"})]})}var y=n(22),p=n(6),g=n(73),N=n(10),k=n.n(N),C=n(30),w=n.n(C);function S(e){var t,n=this,c=e.data,s=e.onClick,o=e.isActive,i=e.className,r=void 0===i?"":i,l=e.checkedList,d=void 0===l?[]:l,u=function(e){o&&s(e)};return Object(a.jsx)("div",{className:k()(w.a.BingoMatrix,(t={},Object(p.a)(t,w.a.active,o),Object(p.a)(t,r,Boolean(r)),t)),children:c.map((function(e,t){return Object(a.jsx)("div",{className:k()(w.a.box,Object(p.a)({},w.a.checked,d.includes(c[t]))),onClick:u.bind(n,t),children:e},t)}))})}var D=n(14),M=n(69),P=n.n(M),R=n(2),L=n.n(R),E=0;function U(e){var t=e.user,n=function(e){var t=Object(c.createRef)(),n=Object(c.createRef)(),s=Object(r.f)(),o=Object(r.g)().room,i=Object(c.createRef)(),d=Object(c.useState)(5),u=Object(D.a)(d,2),h=u[0],m=(u[1],Object(c.createRef)([])),b=Object(c.useState)(""),O=Object(D.a)(b,2),_=O[0],f=O[1],v=Object(c.useState)(null),x=Object(D.a)(v,2),y=x[0],g=x[1],N=Object(c.useState)([]),C=Object(D.a)(N,2),w=C[0],S=C[1],M=Object(c.useState)(null),R=Object(D.a)(M,2),U=R[0],B=R[1],G=Object(c.useState)([]),T=Object(D.a)(G,2),I=T[0],A=T[1],J=Object(c.useState)(Array(Math.pow(h,2)).fill(0)),H=Object(D.a)(J,2),q=H[0],F=H[1],Y=function(t){e.matrix=t,e.updateProcess(o,t.filter((function(e){return e})).length/Math.pow(h,2))},K=function(e){E=e.filter((function(e){return e})).length,F(e),Y(e)},W=function(){var e=Object(l.a)(Array(Math.pow(h,2)).keys()).map((function(e){return e+1})).sort((function(){return.5-Math.random()}));K(e)},z=function(){e.startGame(o,h,h)};return Object(c.useLayoutEffect)((function(){e.join(o),P.a.toDataURL("".concat(location.origin+location.pathname,"/#/").concat(o,"/join").replace("bingo//","bingo/"),{width:512,height:512},(function(e,t){if(e)return console.error(e);B(t)}));var t=function(e){return S(e.filter((function(e){return e})))},n=function(e){return A((function(t){return[].concat(Object(l.a)(t),[e])}))},a=function(){e.leave(),s.push("/denied")},c=function(e){g(e)},i=function(){g(null)},r=function(){e.save(),e.saveMatrix2Server(o,e.matrix),s.replace("/".concat(o,"/game"))};return e.socket.on(j.Denied,a),e.socket.on(j.PlayerUpdate,t),e.socket.on(j.MessageUpdate,n),e.socket.on(j.CountDown,c),e.socket.on(j.CountDownStop,i),e.socket.on(j.CountDownEnd,z),e.socket.on(j.StartGame,r),W(),function(){e.socket.off(j.Denied,a),e.socket.off(j.CountDown,c),e.socket.off(j.PlayerUpdate,t),e.socket.off(j.MessageUpdate,n),e.socket.off(j.CountDown,c),e.socket.off(j.CountDownStop,i),e.socket.off(j.CountDownEnd,z),e.socket.off(j.StartGame,r)}}),[]),Object(c.useEffect)((function(){m.current.scrollTop=m.current.scrollHeight}),[I.length]),{show:_,size:h,count:y,matrix:q,qrcode64:U,userList:w,chatHistory:I,handleSubmit:function(t){t.preventDefault(),e.send(o,n.current.value),n.current.value="",f(""),n.current.blur()},handleRename:function(n){n.preventDefault(),t.current.value&&(e.changeName(o,t.current.value),f(""))},updateProcess:Y,handleStartCountDown:function(){e.startCountDown(o)},handleStartGame:z,matrixProcess:K,resetMatrix:function(){var e=Array(Math.pow(h,2)).fill(0);K(e)},randomMatrix:W,handlePutNum:function(e){if(!q[e]){var t=Object(l.a)(q);t[e]=E+1,K(t)}},toggleShow:function(e){f(_===e?"":e)},handleCopyLink:function(){var e=document.createElement("input"),t=window.location.href;document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Copied!")},handleCountDownCancel:function(){e.countDownCancel(o)},CanvasDOM:Object(a.jsx)("canvas",{ref:i,id:"canvas",className:L.a.qrcode}),NameDOM:Object(a.jsx)("input",{required:!0,type:"text",ref:t,className:L.a.name,placeholder:"your name",defaultValue:e.name}),InputDOM:Object(a.jsx)("input",{type:"text",ref:n,placeholder:"\u8f38\u5165\u8a0a\u606f",required:!0}),ChatHistoryDOM:Object(a.jsx)("div",{className:L.a.chatHistory,ref:m,children:I.map((function(t,n){var c,s,o,i,r;return Object(a.jsx)("div",{className:k()(L.a.msgBox,(o={},Object(p.a)(o,L.a.isMe,e.id===t.user.id),Object(p.a)(o,L.a.same,t.user.id===(null===(c=I[n-1])||void 0===c||null===(s=c.user)||void 0===s?void 0:s.id)),o)),children:Object(a.jsxs)("div",{className:L.a.msg,children:[e.id!==t.user.id&&t.user.id!==(null===(i=I[n-1])||void 0===i||null===(r=i.user)||void 0===r?void 0:r.id)&&Object(a.jsx)("div",{className:L.a.name,children:t.user.name}),Object(a.jsx)("div",{className:L.a.text,children:t.text})]})},n)}))})}}(t),s=n.NameDOM,o=n.InputDOM,i=n.ChatHistoryDOM,d=Object(g.a)(n,["NameDOM","InputDOM","ChatHistoryDOM"]),u=Object(r.g)().room;return Object(a.jsxs)("div",{className:L.a.JoinPage,children:[Object(a.jsxs)("div",{className:L.a.header,children:[Object(a.jsx)("div",{className:L.a.qrcode,onClick:d.toggleShow.bind(this,"qrcode")}),Object(a.jsxs)("div",{className:L.a.playerCount,onClick:d.toggleShow.bind(this,"player"),children:[d.userList.length," Player"]}),Object(a.jsx)("div",{className:L.a.fit}),Object(a.jsx)("div",{className:L.a.userName,onClick:d.toggleShow.bind(this,"rename"),children:t.name}),Object(a.jsx)("div",{className:L.a.matrix,onClick:d.toggleShow.bind(this,"editor")})]}),Object(a.jsxs)("div",{className:L.a.content,children:[Object(a.jsx)("div",{className:k()([L.a.chatPane],Object(p.a)({},L.a.show,""===d.show)),children:i}),Object(a.jsx)("ul",{className:k()([L.a.playerPane],Object(p.a)({},L.a.show,"player"===d.show)),children:d.userList.map((function(e){return Object(a.jsxs)("li",{children:[Object(a.jsx)("div",{className:L.a.name,children:e.name}),Object(a.jsx)("div",{className:k()(L.a.percentage,Object(p.a)({},L.a.fin,1===e.percentage)),children:Object(a.jsx)("div",{className:L.a.bar,style:{width:"".concat(~~(100*e.percentage),"%")}})})]},e.id)}))}),Object(a.jsx)("div",{className:k()([L.a.renamePane],Object(p.a)({},L.a.show,"rename"===d.show)),children:Object(a.jsxs)("form",{onSubmit:d.handleRename,children:[s,Object(a.jsx)("button",{children:"Rename"})]})}),Object(a.jsxs)("div",{className:k()([L.a.editorPane],Object(p.a)({},L.a.show,"editor"===d.show)),children:[Object(a.jsx)(S,Object(y.a)({},{data:d.matrix,onClick:d.handlePutNum,isActive:!0})),Object(a.jsxs)("div",{className:L.a.buttons,children:[Object(a.jsx)("button",{className:L.a.reset,onClick:d.resetMatrix,children:"RESET"}),Object(a.jsx)("button",{className:L.a.random,onClick:d.randomMatrix,children:"RANDOM"})]})]}),Object(a.jsxs)("div",{className:k()([L.a.qrcodePane],Object(p.a)({},L.a.show,"qrcode"===d.show)),children:[Object(a.jsx)("img",{src:d.qrcode64,width:"100%"}),Object(a.jsx)("div",{className:L.a.roomID,children:u}),Object(a.jsx)("div",{className:L.a.link,onClick:d.handleCopyLink,children:"Copy the Link"})]})]}),Object(a.jsxs)("form",{className:L.a.sendMsgBar,onSubmit:d.handleSubmit,children:[!d.userList.findIndex((function(e){return e.id===t.id}))&&Object(a.jsx)("button",{type:"button",className:L.a.startBtn,onClick:d.handleStartCountDown,disabled:d.userList.length<=1||d.userList.some((function(e){var t=e.percentage;return 1!==(void 0===t?0:t)})),children:"Start"}),o,Object(a.jsx)("button",{type:"submit",className:L.a.sendBtn,children:"\u3000"})]}),null!==d.count&&Object(a.jsxs)("div",{className:k()(L.a.countdown),children:[d.count,Object(a.jsx)("button",{className:L.a.stopBtn,onClick:d.handleCountDownCancel,children:"CANCEL"})]})]})}var B=n(70),G=n.n(B),T=n(71),I=n.n(T),A=Object({NODE_ENV:"production",PUBLIC_URL:"/bingo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SOCKET_URL;function J(){var e=Object(r.h)().path,t=Object(c.useMemo)((function(){return new _(G()(A))}),[]);return Object(c.useEffect)((function(){return function(){return t.leave()}}),[]),t?Object(a.jsx)("div",{className:I.a.RoomPage,children:Object(a.jsxs)(r.c,{children:[Object(a.jsx)(r.a,{path:"".concat(e,"/join"),children:Object(a.jsx)(U,Object(y.a)({},{user:t}))}),Object(a.jsx)(r.a,{path:"".concat(e,"/game"),children:Object(a.jsx)(Q,Object(y.a)({},{user:t}))}),Object(a.jsx)(r.a,{path:"*",children:Object(a.jsx)(V,{})})]})}):null}var H=n(5),q=n.n(H),F=0,Y=[],K=[],W=[],z=function(e){var t=+e.split("").map((function(e){return e.charCodeAt()})).join(""),n=~~(t/24)%256,a=~~(t/25)%256;return"rgba(".concat(~~(t/23)%256,", ").concat(n,", ").concat(a,", .45)")};function Q(e){var t,n=e.user,s=Object(r.g)().room,o=Object(r.f)(),l=Object(c.useState)(""),d=Object(D.a)(l,2),u=d[0],h=d[1];Object(c.useLayoutEffect)((function(){var e=function(){n.leave(),o.push("/denied")},t=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],c=arguments.length>4?arguments[4]:void 0;K=e,W=n,Y=a,F=c,h(t)},a=function(e,a,c,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],i=arguments.length>5?arguments[5]:void 0;n.matrix=e,t(a,c,s,o,i)},c=function(){o.replace("/".concat(s,"/join"))};return n.socket.on(j.Denied,e),n.socket.on(m.UpdateChecked,t),n.socket.on(m.SelfMatrix,a),n.socket.on(m.GoJoin,c),n.socket.connected?n.fetchMatrix(s):(n.join(s),n.socket.on(j.PlayerUpdate,(function e(){n.fetchMatrix(s),n.socket.off(j.PlayerUpdate,e)}))),function(){n.socket.off(m.GoJoin,c),n.socket.off(j.Denied,e),n.socket.off(m.SelfMatrix,a),n.socket.off(m.UpdateChecked,t)}}),[]);if(!(null===(t=n.matrix)||void 0===t?void 0:t.length))return null;var b=W.find((function(e){return e.id===u}))||{};return Object(a.jsxs)("div",{className:q.a.GamePage,children:[Object(a.jsxs)("div",{className:q.a.winMap,children:[Object(a.jsx)("div",{className:q.a.start,children:"0"}),Object(a.jsx)("div",{className:q.a.way,children:W.map((function(e,t){return Object(a.jsxs)("div",{className:q.a.player,style:{zIndex:t,left:"".concat(e.winCount/F*100,"%")},children:[Object(a.jsx)("div",{className:q.a.nameColor,style:{backgroundColor:z(e.name)}}),e.name.slice(0,1)]},t)}))}),Object(a.jsx)("div",{className:q.a.end,children:F})]}),Object(a.jsx)("div",{className:q.a.gap,children:Boolean(Y.length)?Object(a.jsxs)("div",{className:q.a.result,children:[Object(a.jsxs)("div",{className:q.a.winList,children:[Object(a.jsx)("div",{className:q.a.winnerIs,children:"Winner is"}),Object(a.jsx)("span",{children:Y.join(", ")})]}),Object(a.jsxs)("div",{className:q.a.buttons,children:[Object(a.jsx)("div",{onClick:function(){n.replay(s)},children:"Replay"}),Object(a.jsx)(i.b,{to:"/",children:"Home"})]})]}):Object(a.jsx)("div",{className:q.a.turn,children:Object(a.jsxs)("div",{className:q.a.title,children:[u===n.id?Object(a.jsx)("div",{className:q.a.your,children:"YOUR"}):Object(a.jsxs)("div",{className:q.a.others,children:[null===b||void 0===b?void 0:b.name,"'s"]}),"TURN"]})})}),Object(a.jsx)(S,Object(y.a)({},{checkedList:K,data:n.matrix,onClick:function(e){K.includes(n.matrix[e])||n.checked(s,n.matrix[e])},className:q.a.Matrix,isActive:u===n.id&&!Y.length}))]})}function Z(){return Object(a.jsx)("div",{children:Object(a.jsx)("h2",{children:"DeniedPage"})})}function V(){return Object(a.jsx)("div",{children:Object(a.jsx)("h2",{children:"NotFoundPage"})})}var X=n(72),$=n.n(X);var ee=function(){return Object(c.useEffect)((function(){new _}),[]),Object(a.jsx)("div",{className:$.a.App,children:Object(a.jsx)(i.a,{children:Object(a.jsxs)(r.c,{children:[Object(a.jsx)(r.a,{exact:!0,path:"/",children:Object(a.jsx)(x,{})}),Object(a.jsx)(r.a,{path:"/denied",children:Object(a.jsx)(Z,{})}),Object(a.jsx)(r.a,{path:"/:room",children:Object(a.jsx)(J,{})}),Object(a.jsx)(r.a,{path:"*",children:Object(a.jsx)(V,{})})]})})})},te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,134)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,s=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),s(e),o(e)}))};o.a.render(Object(a.jsx)(ee,{}),document.getElementById("root")),te()},2:function(e,t,n){e.exports={JoinPage:"style_JoinPage__1yRqt",header:"style_header__3tP8g",qrcode:"style_qrcode__1Ymzf",fit:"style_fit__3ueTB",playerCount:"style_playerCount__2ZlMH",userName:"style_userName__2FLYj",matrix:"style_matrix__3DhF3",content:"style_content__3hdnE",show:"style_show__1iKK8",playerPane:"style_playerPane__3aZLP",name:"style_name__1NsHE",percentage:"style_percentage__1IAjC",bar:"style_bar__WRKm2",fin:"style_fin__-vbWu",qrcodePane:"style_qrcodePane__2NTJq",roomID:"style_roomID__2pQSQ",link:"style_link__3kdmi",renamePane:"style_renamePane__1NFcr",editorPane:"style_editorPane__3dOQM",buttons:"style_buttons__1B8NJ",reset:"style_reset__1bZl_",chatHistory:"style_chatHistory__2fE-_",msgBox:"style_msgBox__oveu_",isMe:"style_isMe__3khzJ",same:"style_same__23AjY",msg:"style_msg__19tUv",text:"style_text__HUwxi",sendMsgBar:"style_sendMsgBar__qhnKV",startBtn:"style_startBtn__3y_kI",sendBtn:"style_sendBtn__1QmdX",countdown:"style_countdown__3tY60",stopBtn:"style_stopBtn__1zDc6"}},30:function(e,t,n){e.exports={BingoMatrix:"style_BingoMatrix__3ELFw",active:"style_active__2Nq_8",box:"style_box__3N-zJ",checked:"style_checked__xbBbd"}},5:function(e,t,n){e.exports={GamePage:"style_GamePage__3oB8L",winMap:"style_winMap__2EpiN",start:"style_start__3UEjd",way:"style_way__3TNYO",player:"style_player__1mIID",nameColor:"style_nameColor__haFkJ",end:"style_end__IFxsV",gap:"style_gap__3ZdYz",result:"style_result__3WXQ5",winList:"style_winList__OB6Xp",winnerIs:"style_winnerIs__8g5sy",buttons:"style_buttons__2R5Gl",turn:"style_turn__4Q5mq",title:"style_title__3wcDe",your:"style_your__1NriA"}},7:function(e,t,n){e.exports={HomePage:"style_HomePage__39HyE",slogan:"style_slogan__3ESLi",ballGroup:"style_ballGroup__3Yrc5",ball:"style_ball__2mxKH",subTitle:"style_subTitle__1-Xg-",menu:"style_menu__2Jp3l",create:"style_create__2PDh_",form:"style_form__3edYN",rule:"style_rule__Cjqvv"}},71:function(e,t,n){},72:function(e,t,n){},79:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.565888ae.chunk.js.map