(this.webpackJsonpbingo=this.webpackJsonpbingo||[]).push([[0],{132:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a(1),s=a(64),i=a.n(s),r=(a(78),a(12)),o=a(3),l=a(10),d=a(65),u=a(66),j={Denied:"RoomDenied",PlayerJoin:"RoomPlayerJoin",PlayerUpdate:"RoomPlayerUpdate",UpdateProcess:"RoomUpdateProcess",MessageSend:"RoomMessageSend",MessageUpdate:"RoomMessageUpdate",StartGame:"RoomStartGame",SaveMatrix:"RoomSaveMatrix",TriggerStartGame:"RoomTriggerStartGame"},h={ChangeName:"UserChangeName"},b={GoJoin:"GameGoJoin",RePlay:"GameRePlay",CheckNum:"GameCheckNum",SelfMatrix:"GameSelfMatrix",FetchMatrix:"GameFetchMatrix",UpdateChecked:"GameUpdateChecked"},m=[].concat(Object(l.a)(Object(l.a)(Array(10).keys()).map((function(e){return e+48}))),Object(l.a)(Object(l.a)(Array(26).keys()).map((function(e){return e+65})))),O=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="",a=0;a<e;a++)t+=String.fromCharCode(m[~~(m.length*Math.random())]);return t},f=function(){function e(t){var a;Object(d.a)(this,e);var n=localStorage.getItem("bingoUser");n||(n=JSON.stringify({name:"Player",id:this.getGUID()}),localStorage.setItem("bingoUser",n));var c=JSON.parse(n);for(var s in c)this[s]=c[s];this.socket=t,null===(a=this.socket)||void 0===a||a.on("connected",(function(e){console.warn("socketID connected: ",e)}))}return Object(u.a)(e,[{key:"save",value:function(){for(var e={},t=Object.keys(this).filter((function(e){return!["socket","room","matrix"].includes(e)})),a=0;a<t.length;a++)e[t[a]]=this[t[a]];localStorage.setItem("bingoUser",JSON.stringify(e))}},{key:"getGUID",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="",a=0;a<e;a++)t+=O(),a%8===7&&(t+="-");return t.slice(0,t.length-1)}},{key:"join",value:function(e){this.socket.emit(j.PlayerJoin,e,JSON.parse(localStorage.getItem("bingoUser")))}},{key:"send",value:function(e,t){this.socket.emit(j.MessageSend,e,t)}},{key:"updateProcess",value:function(e,t){this.socket.emit(j.UpdateProcess,e,t)}},{key:"changeName",value:function(e,t){this.name=t,this.save(),this.socket.emit(h.ChangeName,e,t)}},{key:"startGame",value:function(e,t,a){this.socket.emit(j.TriggerStartGame,e,t,a)}},{key:"saveMatrix2Server",value:function(e,t){this.socket.emit(j.SaveMatrix,e,t)}},{key:"checked",value:function(e,t){this.checkedList||(this.checkedList=[]),this.checkedList=Object(l.a)(new Set([].concat(Object(l.a)(this.checkedList),[t]))).sort((function(e,t){return e-t})),this.socket.emit(b.CheckNum,e,t)}},{key:"fetchMatrix",value:function(e){this.socket.emit(b.FetchMatrix,e)}},{key:"replay",value:function(e){this.socket.emit(b.RePlay,e)}},{key:"leave",value:function(){null===this||void 0===this||this.socket.close()}}]),e}(),x=a(6),v=a.n(x);function _(){var e=Object(o.f)(),t=Object(c.useRef)();return Object(n.jsxs)("div",{className:v.a.HomePage,children:[Object(n.jsxs)("div",{className:v.a.slogan,children:[Object(n.jsxs)("div",{className:v.a.ballGroup,children:[Object(n.jsx)("div",{className:v.a.ball,children:"B"}),Object(n.jsx)("div",{className:v.a.ball,children:"I"}),Object(n.jsx)("div",{className:v.a.ball,children:"N"}),Object(n.jsx)("div",{className:v.a.ball,children:"G"}),Object(n.jsx)("div",{className:v.a.ball,children:"O"})]}),Object(n.jsx)("div",{className:v.a.subTitle,children:"ONLINE BATTLE"})]}),Object(n.jsxs)("div",{className:v.a.menu,children:[Object(n.jsx)("button",{className:v.a.create,onClick:function(){e.replace("/".concat(O(4),"/join"))},children:"CREATE"}),Object(n.jsx)("h3",{children:"OR"}),Object(n.jsxs)("form",{onSubmit:function(a){a.preventDefault(),e.replace("/".concat(t.current.value,"/join"))},className:v.a.form,children:[Object(n.jsx)("input",{required:!0,type:"text",ref:t,maxLength:"4",pattern:"[0-9A-Z]{4}",placeholder:"ROOM ID"}),Object(n.jsx)("button",{children:"JOIN"})]})]}),Object(n.jsx)(r.b,{className:v.a.rule,to:"/rule",children:"HOW TO PLAY"})]})}var y=a(21),g=a(5),p=a(72),k=a(9),N=a.n(k),M=a(29),S=a.n(M);function P(e){var t=this,a=e.data,c=e.onClick,s=e.checkedList,i=void 0===s?[]:s,r=e.isActive,o=function(e){r&&c(e)};return Object(n.jsx)("div",{className:N()(S.a.BingoMatrix,Object(g.a)({},S.a.active,r)),children:a.map((function(e,c){return Object(n.jsx)("div",{className:N()(S.a.box,Object(g.a)({},S.a.checked,i.includes(a[c]))),onClick:o.bind(t,c),children:e},c)}))})}var C=a(18),w=a(68),D=a.n(w),G=a(2),R=a.n(G),U=0;function I(e){var t=e.user,a=function(e){var t=Object(c.createRef)(),a=Object(c.createRef)(),s=Object(c.createRef)(),i=Object(c.createRef)([]),r=Object(o.f)(),d=Object(o.g)().room,u=Object(c.useState)(5),h=Object(C.a)(u,2),b=h[0],m=(h[1],Object(c.useState)("")),O=Object(C.a)(m,2),f=O[0],x=O[1],v=Object(c.useState)(null),_=Object(C.a)(v,2),y=_[0],p=_[1],k=Object(c.useState)([]),M=Object(C.a)(k,2),S=M[0],P=M[1],w=Object(c.useState)([]),G=Object(C.a)(w,2),I=G[0],L=G[1],B=Object(c.useState)(Array(Math.pow(b,2)).fill(0)),J=Object(C.a)(B,2),T=J[0],A=J[1],H=function(t){console.warn("updateProcess"),e.matrix=t,e.updateProcess(d,t.filter((function(e){return e})).length/Math.pow(b,2))},q=function(e){U=e.filter((function(e){return e})).length,A(e),H(e)},E=function(){var e=Object(l.a)(Array(Math.pow(b,2)).keys()).map((function(e){return e+1})).sort((function(){return.5-Math.random()}));q(e)};return Object(c.useLayoutEffect)((function(){e.join(d),D.a.toDataURL("".concat("//bingo-ws.sexyoung.tw","/#/").concat(d,"/join"),{width:512,height:512},(function(e,t){if(e)return console.error(e);p(t)}));var t=function(e){return P(e.filter((function(e){return e})))},a=function(e){return L((function(t){return[].concat(Object(l.a)(t),[e])}))},n=function(){},c=function(){e.save(),e.saveMatrix2Server(d,e.matrix),r.replace("/".concat(d,"/game"))};return e.socket.on(j.Denied,n),e.socket.on(j.PlayerUpdate,t),e.socket.on(j.MessageUpdate,a),e.socket.on(j.StartGame,c),E(),function(){e.socket.off(j.Denied,n),e.socket.off(j.StartGame,c),e.socket.off(j.PlayerUpdate,t),e.socket.off(j.MessageUpdate,a)}}),[]),Object(c.useEffect)((function(){console.warn("do it"),i.current.scrollTop=i.current.scrollHeight}),[I.length]),{show:f,size:b,matrix:T,qrcode64:y,userList:S,chatHistory:I,handleSubmit:function(t){t.preventDefault(),e.send(d,a.current.value),a.current.value="",x(""),a.current.blur()},handleRename:function(a){a.preventDefault(),t.current.value&&(e.changeName(d,t.current.value),x(""))},updateProcess:H,handleStartGame:function(){console.warn("satt"),e.startGame(d,b,b)},matrixProcess:q,resetMatrix:function(){var e=Array(Math.pow(b,2)).fill(0);q(e)},randomMatrix:E,handlePutNum:function(e){if(!T[e]){var t=Object(l.a)(T);t[e]=U+1,q(t)}},toggleShow:function(e){x(f===e?"":e)},handleCopyLink:function(){var e=document.createElement("input"),t=window.location.href;document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Copied!")},CanvasDOM:Object(n.jsx)("canvas",{ref:s,id:"canvas",className:R.a.qrcode}),NameDOM:Object(n.jsx)("input",{required:!0,type:"text",ref:t,className:R.a.name,placeholder:"your name",defaultValue:e.name}),InputDOM:Object(n.jsx)("input",{type:"text",ref:a,placeholder:"\u8f38\u5165\u8a0a\u606f"}),ChatHistoryDOM:Object(n.jsx)("div",{className:R.a.chatHistory,ref:i,children:I.map((function(t,a){var c,s,i,r,o;return Object(n.jsx)("div",{className:N()(R.a.msgBox,(i={},Object(g.a)(i,R.a.isMe,e.id===t.user.id),Object(g.a)(i,R.a.same,t.user.id===(null===(c=I[a-1])||void 0===c||null===(s=c.user)||void 0===s?void 0:s.id)),i)),children:Object(n.jsxs)("div",{className:R.a.msg,children:[e.id!==t.user.id&&t.user.id!==(null===(r=I[a-1])||void 0===r||null===(o=r.user)||void 0===o?void 0:o.id)&&Object(n.jsx)("div",{className:R.a.name,children:t.user.name}),Object(n.jsx)("div",{className:R.a.text,children:t.text})]})},a)}))})}}(t),s=a.NameDOM,i=a.InputDOM,r=a.ChatHistoryDOM,d=Object(p.a)(a,["NameDOM","InputDOM","ChatHistoryDOM"]),u=Object(o.g)().room;return Object(n.jsxs)("div",{className:R.a.JoinPage,children:[Object(n.jsxs)("div",{className:R.a.header,children:[Object(n.jsx)("div",{className:R.a.qrcode,onClick:d.toggleShow.bind(this,"qrcode")}),Object(n.jsxs)("div",{className:R.a.playerCount,onClick:d.toggleShow.bind(this,"player"),children:[d.userList.length," Player"]}),Object(n.jsx)("div",{className:R.a.fit}),Object(n.jsx)("div",{className:R.a.userName,onClick:d.toggleShow.bind(this,"rename"),children:t.name}),Object(n.jsx)("div",{className:R.a.matrix,onClick:d.toggleShow.bind(this,"editor")})]}),Object(n.jsxs)("div",{className:R.a.content,children:[Object(n.jsx)("div",{className:N()([R.a.chatPane],Object(g.a)({},R.a.show,""===d.show)),children:r}),Object(n.jsx)("ul",{className:N()([R.a.playerPane],Object(g.a)({},R.a.show,"player"===d.show)),children:d.userList.map((function(e,t){return Object(n.jsxs)("li",{children:[Object(n.jsx)("div",{className:R.a.name,children:e.name}),Object(n.jsx)("div",{className:N()(R.a.percentage,Object(g.a)({},R.a.fin,1===e.percentage)),children:Object(n.jsx)("div",{className:R.a.bar,style:{width:"".concat(~~(100*e.percentage),"%")}})})]},e.id)}))}),Object(n.jsx)("div",{className:N()([R.a.renamePane],Object(g.a)({},R.a.show,"rename"===d.show)),children:Object(n.jsxs)("form",{onSubmit:d.handleRename,children:[s,Object(n.jsx)("button",{children:"Rename"})]})}),Object(n.jsxs)("div",{className:N()([R.a.editorPane],Object(g.a)({},R.a.show,"editor"===d.show)),children:[Object(n.jsx)(P,Object(y.a)({},{data:d.matrix,onClick:d.handlePutNum,isActive:!0})),Object(n.jsxs)("div",{className:R.a.buttons,children:[Object(n.jsx)("button",{className:R.a.reset,onClick:d.resetMatrix,children:"RESET"}),Object(n.jsx)("button",{className:R.a.random,onClick:d.randomMatrix,children:"RANDOM"})]})]}),Object(n.jsxs)("div",{className:N()([R.a.qrcodePane],Object(g.a)({},R.a.show,"qrcode"===d.show)),children:[Object(n.jsx)("img",{src:d.qrcode64,width:"100%"}),Object(n.jsx)("div",{className:R.a.roomID,children:u}),Object(n.jsx)("div",{className:R.a.link,onClick:d.handleCopyLink,children:"Copy the Link"})]})]}),Object(n.jsxs)("form",{className:R.a.sendMsgBar,onSubmit:d.handleSubmit,children:[!d.userList.findIndex((function(e){return e.id===t.id}))&&Object(n.jsx)("button",{type:"button",className:R.a.startBtn,onClick:d.handleStartGame,disabled:d.userList.some((function(e){var t=e.percentage;return 1!==(void 0===t?0:t)})),children:"Start"}),i,Object(n.jsx)("button",{type:"submit",className:R.a.sendBtn,children:"\u3000"})]})]})}var L=a(69),B=a.n(L),J=a(70),T=a.n(J);function A(){var e=Object(o.h)().path,t=Object(c.useMemo)((function(){return new f(B()("//bingo-ws.sexyoung.tw"))}),[]);return Object(c.useEffect)((function(){return function(){return t.leave()}}),[]),t?Object(n.jsx)("div",{className:T.a.RoomPage,children:Object(n.jsxs)(o.c,{children:[Object(n.jsx)(o.a,{path:"".concat(e,"/join"),children:Object(n.jsx)(I,Object(y.a)({},{user:t}))}),Object(n.jsx)(o.a,{path:"".concat(e,"/game"),children:Object(n.jsx)(F,Object(y.a)({},{user:t}))}),Object(n.jsx)(o.a,{path:"*",children:Object(n.jsx)(Q,{})})]})}):null}var H=[],q=[],E=[];function F(e){var t,a=e.user,s=Object(o.g)().room,i=Object(o.f)(),l=Object(c.useState)(""),d=Object(C.a)(l,2),u=d[0],h=d[1];Object(c.useLayoutEffect)((function(){var e=function(){a.leave(),i.push("/denied")},t=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];H=e,q=a,E=n,h(t)},n=function(e,n,c,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];a.matrix=e,t(n,c,s,i)},c=function(){i.replace("/".concat(s,"/join"))};return a.socket.on(j.Denied,e),a.socket.on(b.UpdateChecked,t),a.socket.on(b.SelfMatrix,n),a.socket.on(b.GoJoin,c),a.socket.connected?a.fetchMatrix(s):(a.join(s),a.socket.on(j.PlayerUpdate,(function e(){a.fetchMatrix(s),a.socket.off(j.PlayerUpdate,e)}))),function(){a.socket.off(b.GoJoin,c),a.socket.off(j.Denied,e),a.socket.off(b.SelfMatrix,n),a.socket.off(b.UpdateChecked,t)}}),[]);return(null===(t=a.matrix)||void 0===t?void 0:t.length)?Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"GamePage"}),Boolean(E.length)&&Object(n.jsxs)("div",{children:[Object(n.jsx)("h2",{children:"Result"}),E.map((function(e,t){return Object(n.jsxs)("div",{children:[e," WIN!"]},t)})),Object(n.jsx)("div",{onClick:function(){a.replay(s)},children:"Play again"}),Object(n.jsx)(r.b,{to:"/",children:"Home"})]}),Object(n.jsx)(P,Object(y.a)({},{checkedList:H,data:a.matrix,onClick:function(e){H.includes(a.matrix[e])||a.checked(s,a.matrix[e])},isActive:u===a.id&&!E.length})),q.map((function(e,t){return Object(n.jsxs)("div",{children:[e.name,": ",e.winCount]},t)}))]}):null}function W(){return Object(n.jsx)("div",{children:Object(n.jsx)("h2",{children:"DeniedPage"})})}function Q(){return Object(n.jsx)("div",{children:Object(n.jsx)("h2",{children:"NotFoundPage"})})}var Y=a(71),K=a.n(Y);var V=function(){return Object(c.useEffect)((function(){new f}),[]),Object(n.jsx)("div",{className:K.a.App,children:Object(n.jsx)(r.a,{children:Object(n.jsxs)(o.c,{children:[Object(n.jsx)(o.a,{exact:!0,path:"/",children:Object(n.jsx)(_,{})}),Object(n.jsx)(o.a,{path:"/denied",children:Object(n.jsx)(W,{})}),Object(n.jsx)(o.a,{path:"/:room",children:Object(n.jsx)(A,{})}),Object(n.jsx)(o.a,{path:"*",children:Object(n.jsx)(Q,{})})]})})})},X=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,133)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};i.a.render(Object(n.jsx)(V,{}),document.getElementById("root")),X()},2:function(e,t,a){e.exports={JoinPage:"style_JoinPage__2syIx",header:"style_header__3D9a2",qrcode:"style_qrcode__1d2Ih",fit:"style_fit__3Id8l",playerCount:"style_playerCount__24TPd",userName:"style_userName__2lbWH",matrix:"style_matrix__i1Hxj",content:"style_content__1DY98",show:"style_show__3pNc2",playerPane:"style_playerPane__Unfwr",name:"style_name__sMT9-",percentage:"style_percentage__WG0Bt",bar:"style_bar__29tX8",fin:"style_fin__3TZgo",qrcodePane:"style_qrcodePane__2tszi",roomID:"style_roomID__3ktQi",link:"style_link__3AbK3",renamePane:"style_renamePane__12SQR",editorPane:"style_editorPane__3Sfxe",buttons:"style_buttons__1iFOr",reset:"style_reset__yDkTt",chatHistory:"style_chatHistory__2wbkW",msgBox:"style_msgBox__hGsqv",isMe:"style_isMe__-isJe",same:"style_same__2VOC-",msg:"style_msg__3PQjO",text:"style_text__304iS",sendMsgBar:"style_sendMsgBar__1ij9P",startBtn:"style_startBtn__1oVQu",sendBtn:"style_sendBtn__1Mg_5",modal:"style_modal__19i7X"}},29:function(e,t,a){e.exports={BingoMatrix:"style_BingoMatrix__1RrGy",active:"style_active__2ah_b",box:"style_box__1Ip5K",checked:"style_checked__3lblk"}},6:function(e,t,a){e.exports={HomePage:"style_HomePage__3XSZG",slogan:"style_slogan__n5BS6",ballGroup:"style_ballGroup__1ehfJ",ball:"style_ball__deFA8",subTitle:"style_subTitle__3YQD5",menu:"style_menu__1rbYY",create:"style_create__3WjcK",form:"style_form__1WyxL",rule:"style_rule__1e9G3"}},70:function(e,t,a){},71:function(e,t,a){},78:function(e,t,a){}},[[132,1,2]]]);
//# sourceMappingURL=main.6bf74b07.chunk.js.map