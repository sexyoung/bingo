(this.webpackJsonpbingo=this.webpackJsonpbingo||[]).push([[0],{133:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a(1),s=a(65),i=a.n(s),r=(a(79),a(13)),o=a(3),l=a(11),d=a(66),u=a(67),j={Denied:"RoomDenied",PlayerJoin:"RoomPlayerJoin",PlayerUpdate:"RoomPlayerUpdate",UpdateProcess:"RoomUpdateProcess",MessageSend:"RoomMessageSend",MessageUpdate:"RoomMessageUpdate",StartGame:"RoomStartGame",SaveMatrix:"RoomSaveMatrix",TriggerStartGame:"RoomTriggerStartGame"},h={ChangeName:"UserChangeName"},m={GoJoin:"GameGoJoin",RePlay:"GameRePlay",CheckNum:"GameCheckNum",SelfMatrix:"GameSelfMatrix",FetchMatrix:"GameFetchMatrix",UpdateChecked:"GameUpdateChecked"},b=[].concat(Object(l.a)(Object(l.a)(Array(10).keys()).map((function(e){return e+48}))),Object(l.a)(Object(l.a)(Array(26).keys()).map((function(e){return e+65})))),O=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="",a=0;a<e;a++)t+=String.fromCharCode(b[~~(b.length*Math.random())]);return t},_=function(){function e(t){var a;Object(d.a)(this,e);var n=localStorage.getItem("bingoUser");n||(n=JSON.stringify({name:"Player",id:this.getGUID()}),localStorage.setItem("bingoUser",n));var c=JSON.parse(n);for(var s in c)this[s]=c[s];this.socket=t,null===(a=this.socket)||void 0===a||a.on("connected",(function(e){console.warn("socketID connected: ",e)}))}return Object(u.a)(e,[{key:"save",value:function(){for(var e={},t=Object.keys(this).filter((function(e){return!["socket","room","matrix"].includes(e)})),a=0;a<t.length;a++)e[t[a]]=this[t[a]];localStorage.setItem("bingoUser",JSON.stringify(e))}},{key:"getGUID",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,t="",a=0;a<e;a++)t+=O(),a%8===7&&(t+="-");return t.slice(0,t.length-1)}},{key:"join",value:function(e){this.socket.emit(j.PlayerJoin,e,JSON.parse(localStorage.getItem("bingoUser")))}},{key:"send",value:function(e,t){this.socket.emit(j.MessageSend,e,t)}},{key:"updateProcess",value:function(e,t){this.socket.emit(j.UpdateProcess,e,t)}},{key:"changeName",value:function(e,t){this.name=t,this.save(),this.socket.emit(h.ChangeName,e,t)}},{key:"startGame",value:function(e,t,a){this.socket.emit(j.TriggerStartGame,e,t,a)}},{key:"saveMatrix2Server",value:function(e,t){this.socket.emit(j.SaveMatrix,e,t)}},{key:"checked",value:function(e,t){this.checkedList||(this.checkedList=[]),this.checkedList=Object(l.a)(new Set([].concat(Object(l.a)(this.checkedList),[t]))).sort((function(e,t){return e-t})),this.socket.emit(m.CheckNum,e,t)}},{key:"fetchMatrix",value:function(e){this.socket.emit(m.FetchMatrix,e)}},{key:"replay",value:function(e){this.socket.emit(m.RePlay,e)}},{key:"leave",value:function(){null===this||void 0===this||this.socket.close()}}]),e}(),f=a(6),x=a.n(f);function v(){var e=Object(o.f)(),t=Object(c.useRef)();return Object(n.jsxs)("div",{className:x.a.HomePage,children:[Object(n.jsxs)("div",{className:x.a.slogan,children:[Object(n.jsxs)("div",{className:x.a.ballGroup,children:[Object(n.jsx)("div",{className:x.a.ball,children:"B"}),Object(n.jsx)("div",{className:x.a.ball,children:"I"}),Object(n.jsx)("div",{className:x.a.ball,children:"N"}),Object(n.jsx)("div",{className:x.a.ball,children:"G"}),Object(n.jsx)("div",{className:x.a.ball,children:"O"})]}),Object(n.jsx)("div",{className:x.a.subTitle,children:"ONLINE BATTLE"})]}),Object(n.jsxs)("div",{className:x.a.menu,children:[Object(n.jsx)("button",{className:x.a.create,onClick:function(){e.replace("/".concat(O(4),"/join"))},children:"CREATE"}),Object(n.jsx)("h3",{children:"OR"}),Object(n.jsxs)("form",{onSubmit:function(a){a.preventDefault(),e.replace("/".concat(t.current.value,"/join"))},className:x.a.form,children:[Object(n.jsx)("input",{required:!0,type:"text",ref:t,maxLength:"4",pattern:"[0-9A-Z]{4}",placeholder:"ROOM ID"}),Object(n.jsx)("button",{children:"JOIN"})]})]}),Object(n.jsx)(r.b,{className:x.a.rule,to:"/rule",children:"HOW TO PLAY"})]})}var y=a(22),p=a(5),g=a(73),N=a(10),k=a.n(N),M=a(30),P=a.n(M);function w(e){var t,a=this,c=e.data,s=e.onClick,i=e.isActive,r=e.className,o=void 0===r?"":r,l=e.checkedList,d=void 0===l?[]:l,u=function(e){i&&s(e)};return Object(n.jsx)("div",{className:k()(P.a.BingoMatrix,(t={},Object(p.a)(t,P.a.active,i),Object(p.a)(t,o,Boolean(o)),t)),children:c.map((function(e,t){return Object(n.jsx)("div",{className:k()(P.a.box,Object(p.a)({},P.a.checked,d.includes(c[t]))),onClick:u.bind(a,t),children:e},t)}))})}var S=a(19),C=a(69),D=a.n(C),G=a(2),L=a.n(G),R=0;function I(e){var t=e.user,a=function(e){var t=Object(c.createRef)(),a=Object(c.createRef)(),s=Object(c.createRef)(),i=Object(c.createRef)([]),r=Object(o.f)(),d=Object(o.g)().room,u=Object(c.useState)(5),h=Object(S.a)(u,2),m=h[0],b=(h[1],Object(c.useState)("")),O=Object(S.a)(b,2),_=O[0],f=O[1],x=Object(c.useState)(null),v=Object(S.a)(x,2),y=v[0],g=v[1],N=Object(c.useState)([]),M=Object(S.a)(N,2),P=M[0],w=M[1],C=Object(c.useState)([]),G=Object(S.a)(C,2),I=G[0],U=G[1],B=Object(c.useState)(Array(Math.pow(m,2)).fill(0)),J=Object(S.a)(B,2),E=J[0],q=J[1],H=function(t){console.warn("updateProcess"),e.matrix=t,e.updateProcess(d,t.filter((function(e){return e})).length/Math.pow(m,2))},A=function(e){R=e.filter((function(e){return e})).length,q(e),H(e)},T=function(){var e=Object(l.a)(Array(Math.pow(m,2)).keys()).map((function(e){return e+1})).sort((function(){return.5-Math.random()}));A(e)};return Object(c.useLayoutEffect)((function(){e.join(d),D.a.toDataURL("".concat(location.origin+location.pathname,"/#/").concat(d,"/join").replace("bingo//","bingo/"),{width:512,height:512},(function(e,t){if(e)return console.error(e);g(t)}));var t=function(e){return w(e.filter((function(e){return e})))},a=function(e){return U((function(t){return[].concat(Object(l.a)(t),[e])}))},n=function(){},c=function(){e.save(),e.saveMatrix2Server(d,e.matrix),r.replace("/".concat(d,"/game"))};return e.socket.on(j.Denied,n),e.socket.on(j.PlayerUpdate,t),e.socket.on(j.MessageUpdate,a),e.socket.on(j.StartGame,c),T(),function(){e.socket.off(j.Denied,n),e.socket.off(j.StartGame,c),e.socket.off(j.PlayerUpdate,t),e.socket.off(j.MessageUpdate,a)}}),[]),Object(c.useEffect)((function(){console.warn("do it"),i.current.scrollTop=i.current.scrollHeight}),[I.length]),{show:_,size:m,matrix:E,qrcode64:y,userList:P,chatHistory:I,handleSubmit:function(t){t.preventDefault(),e.send(d,a.current.value),a.current.value="",f(""),a.current.blur()},handleRename:function(a){a.preventDefault(),t.current.value&&(e.changeName(d,t.current.value),f(""))},updateProcess:H,handleStartGame:function(){console.warn("satt"),e.startGame(d,m,m)},matrixProcess:A,resetMatrix:function(){var e=Array(Math.pow(m,2)).fill(0);A(e)},randomMatrix:T,handlePutNum:function(e){if(!E[e]){var t=Object(l.a)(E);t[e]=R+1,A(t)}},toggleShow:function(e){f(_===e?"":e)},handleCopyLink:function(){var e=document.createElement("input"),t=window.location.href;document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Copied!")},CanvasDOM:Object(n.jsx)("canvas",{ref:s,id:"canvas",className:L.a.qrcode}),NameDOM:Object(n.jsx)("input",{required:!0,type:"text",ref:t,className:L.a.name,placeholder:"your name",defaultValue:e.name}),InputDOM:Object(n.jsx)("input",{type:"text",ref:a,placeholder:"\u8f38\u5165\u8a0a\u606f"}),ChatHistoryDOM:Object(n.jsx)("div",{className:L.a.chatHistory,ref:i,children:I.map((function(t,a){var c,s,i,r,o;return Object(n.jsx)("div",{className:k()(L.a.msgBox,(i={},Object(p.a)(i,L.a.isMe,e.id===t.user.id),Object(p.a)(i,L.a.same,t.user.id===(null===(c=I[a-1])||void 0===c||null===(s=c.user)||void 0===s?void 0:s.id)),i)),children:Object(n.jsxs)("div",{className:L.a.msg,children:[e.id!==t.user.id&&t.user.id!==(null===(r=I[a-1])||void 0===r||null===(o=r.user)||void 0===o?void 0:o.id)&&Object(n.jsx)("div",{className:L.a.name,children:t.user.name}),Object(n.jsx)("div",{className:L.a.text,children:t.text})]})},a)}))})}}(t),s=a.NameDOM,i=a.InputDOM,r=a.ChatHistoryDOM,d=Object(g.a)(a,["NameDOM","InputDOM","ChatHistoryDOM"]),u=Object(o.g)().room;return Object(n.jsxs)("div",{className:L.a.JoinPage,children:[Object(n.jsxs)("div",{className:L.a.header,children:[Object(n.jsx)("div",{className:L.a.qrcode,onClick:d.toggleShow.bind(this,"qrcode")}),Object(n.jsxs)("div",{className:L.a.playerCount,onClick:d.toggleShow.bind(this,"player"),children:[d.userList.length," Player"]}),Object(n.jsx)("div",{className:L.a.fit}),Object(n.jsx)("div",{className:L.a.userName,onClick:d.toggleShow.bind(this,"rename"),children:t.name}),Object(n.jsx)("div",{className:L.a.matrix,onClick:d.toggleShow.bind(this,"editor")})]}),Object(n.jsxs)("div",{className:L.a.content,children:[Object(n.jsx)("div",{className:k()([L.a.chatPane],Object(p.a)({},L.a.show,""===d.show)),children:r}),Object(n.jsx)("ul",{className:k()([L.a.playerPane],Object(p.a)({},L.a.show,"player"===d.show)),children:d.userList.map((function(e,t){return Object(n.jsxs)("li",{children:[Object(n.jsx)("div",{className:L.a.name,children:e.name}),Object(n.jsx)("div",{className:k()(L.a.percentage,Object(p.a)({},L.a.fin,1===e.percentage)),children:Object(n.jsx)("div",{className:L.a.bar,style:{width:"".concat(~~(100*e.percentage),"%")}})})]},e.id)}))}),Object(n.jsx)("div",{className:k()([L.a.renamePane],Object(p.a)({},L.a.show,"rename"===d.show)),children:Object(n.jsxs)("form",{onSubmit:d.handleRename,children:[s,Object(n.jsx)("button",{children:"Rename"})]})}),Object(n.jsxs)("div",{className:k()([L.a.editorPane],Object(p.a)({},L.a.show,"editor"===d.show)),children:[Object(n.jsx)(w,Object(y.a)({},{data:d.matrix,onClick:d.handlePutNum,isActive:!0})),Object(n.jsxs)("div",{className:L.a.buttons,children:[Object(n.jsx)("button",{className:L.a.reset,onClick:d.resetMatrix,children:"RESET"}),Object(n.jsx)("button",{className:L.a.random,onClick:d.randomMatrix,children:"RANDOM"})]})]}),Object(n.jsxs)("div",{className:k()([L.a.qrcodePane],Object(p.a)({},L.a.show,"qrcode"===d.show)),children:[Object(n.jsx)("img",{src:d.qrcode64,width:"100%"}),Object(n.jsx)("div",{className:L.a.roomID,children:u}),Object(n.jsx)("div",{className:L.a.link,onClick:d.handleCopyLink,children:"Copy the Link"})]})]}),Object(n.jsxs)("form",{className:L.a.sendMsgBar,onSubmit:d.handleSubmit,children:[!d.userList.findIndex((function(e){return e.id===t.id}))&&Object(n.jsx)("button",{type:"button",className:L.a.startBtn,onClick:d.handleStartGame,disabled:d.userList.some((function(e){var t=e.percentage;return 1!==(void 0===t?0:t)})),children:"Start"}),i,Object(n.jsx)("button",{type:"submit",className:L.a.sendBtn,children:"\u3000"})]})]})}var U=a(70),B=a.n(U),J=a(71),E=a.n(J);function q(){var e=Object(o.h)().path,t=Object(c.useMemo)((function(){return new _(B()("//bingo-ws.sexyoung.tw"))}),[]);return Object(c.useEffect)((function(){return function(){return t.leave()}}),[]),t?Object(n.jsx)("div",{className:E.a.RoomPage,children:Object(n.jsxs)(o.c,{children:[Object(n.jsx)(o.a,{path:"".concat(e,"/join"),children:Object(n.jsx)(I,Object(y.a)({},{user:t}))}),Object(n.jsx)(o.a,{path:"".concat(e,"/game"),children:Object(n.jsx)(Q,Object(y.a)({},{user:t}))}),Object(n.jsx)(o.a,{path:"*",children:Object(n.jsx)(Z,{})})]})}):null}var H=a(7),A=a.n(H),T=0,F=[],Y=[],z=[],K=function(e){var t=+e.split("").map((function(e){return e.charCodeAt()})).join(""),a=~~(t/24)%256,n=~~(t/25)%256;return"rgba(".concat(~~(t/23)%256,", ").concat(a,", ").concat(n,", .25)")};function Q(e){var t,a=e.user,s=Object(o.g)().room,i=Object(o.f)(),l=Object(c.useState)(""),d=Object(S.a)(l,2),u=d[0],h=d[1];Object(c.useLayoutEffect)((function(){var e=function(){a.leave(),i.push("/denied")},t=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],c=arguments.length>4?arguments[4]:void 0;Y=e,z=a,F=n,T=c,h(t)},n=function(e,n,c,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],r=arguments.length>5?arguments[5]:void 0;a.matrix=e,t(n,c,s,i,r)},c=function(){i.replace("/".concat(s,"/join"))};return a.socket.on(j.Denied,e),a.socket.on(m.UpdateChecked,t),a.socket.on(m.SelfMatrix,n),a.socket.on(m.GoJoin,c),a.socket.connected?a.fetchMatrix(s):(a.join(s),a.socket.on(j.PlayerUpdate,(function e(){a.fetchMatrix(s),a.socket.off(j.PlayerUpdate,e)}))),function(){a.socket.off(m.GoJoin,c),a.socket.off(j.Denied,e),a.socket.off(m.SelfMatrix,n),a.socket.off(m.UpdateChecked,t)}}),[]);return(null===(t=a.matrix)||void 0===t?void 0:t.length)?Object(n.jsxs)("div",{className:A.a.GamePage,children:[Object(n.jsxs)("div",{className:A.a.winMap,children:[Object(n.jsx)("div",{className:A.a.start,children:"0"}),Object(n.jsx)("div",{className:A.a.way,children:z.map((function(e,t){return Object(n.jsxs)("div",{className:A.a.player,style:{zIndex:t,left:"".concat(e.winCount/T*100,"%")},children:[Object(n.jsx)("div",{className:A.a.nameColor,style:{backgroundColor:K(e.name)}}),e.name.slice(0,1)]},t)}))}),Object(n.jsx)("div",{className:A.a.end,children:T})]}),Object(n.jsx)("div",{className:A.a.gap,children:Boolean(F.length)&&Object(n.jsxs)("div",{className:A.a.result,children:[Object(n.jsxs)("div",{className:A.a.winList,children:[Object(n.jsx)("div",{className:A.a.winnerIs,children:"Winner is"}),Object(n.jsx)("span",{children:F.join(", ")})]}),Object(n.jsxs)("div",{className:A.a.buttons,children:[Object(n.jsx)("div",{onClick:function(){a.replay(s)},children:"Replay"}),Object(n.jsx)(r.b,{to:"/",children:"Home"})]})]})}),Object(n.jsx)(w,Object(y.a)({},{checkedList:Y,data:a.matrix,onClick:function(e){Y.includes(a.matrix[e])||a.checked(s,a.matrix[e])},className:A.a.Matrix,isActive:u===a.id&&!F.length}))]}):null}function W(){return Object(n.jsx)("div",{children:Object(n.jsx)("h2",{children:"DeniedPage"})})}function Z(){return Object(n.jsx)("div",{children:Object(n.jsx)("h2",{children:"NotFoundPage"})})}var X=a(72),V=a.n(X);var $=function(){return Object(c.useEffect)((function(){new _}),[]),Object(n.jsx)("div",{className:V.a.App,children:Object(n.jsx)(r.a,{children:Object(n.jsxs)(o.c,{children:[Object(n.jsx)(o.a,{exact:!0,path:"/",children:Object(n.jsx)(v,{})}),Object(n.jsx)(o.a,{path:"/denied",children:Object(n.jsx)(W,{})}),Object(n.jsx)(o.a,{path:"/:room",children:Object(n.jsx)(q,{})}),Object(n.jsx)(o.a,{path:"*",children:Object(n.jsx)(Z,{})})]})})})},ee=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,134)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};i.a.render(Object(n.jsx)($,{}),document.getElementById("root")),ee()},2:function(e,t,a){e.exports={JoinPage:"style_JoinPage__1yRqt",header:"style_header__3tP8g",qrcode:"style_qrcode__1Ymzf",fit:"style_fit__3ueTB",playerCount:"style_playerCount__2ZlMH",userName:"style_userName__2FLYj",matrix:"style_matrix__3DhF3",content:"style_content__3hdnE",show:"style_show__1iKK8",playerPane:"style_playerPane__3aZLP",name:"style_name__1NsHE",percentage:"style_percentage__1IAjC",bar:"style_bar__WRKm2",fin:"style_fin__-vbWu",qrcodePane:"style_qrcodePane__2NTJq",roomID:"style_roomID__2pQSQ",link:"style_link__3kdmi",renamePane:"style_renamePane__1NFcr",editorPane:"style_editorPane__3dOQM",buttons:"style_buttons__1B8NJ",reset:"style_reset__1bZl_",chatHistory:"style_chatHistory__2fE-_",msgBox:"style_msgBox__oveu_",isMe:"style_isMe__3khzJ",same:"style_same__23AjY",msg:"style_msg__19tUv",text:"style_text__HUwxi",sendMsgBar:"style_sendMsgBar__qhnKV",startBtn:"style_startBtn__3y_kI",sendBtn:"style_sendBtn__1QmdX",modal:"style_modal__3Dz6u"}},30:function(e,t,a){e.exports={BingoMatrix:"style_BingoMatrix__3ELFw",active:"style_active__2Nq_8",box:"style_box__3N-zJ",checked:"style_checked__xbBbd"}},6:function(e,t,a){e.exports={HomePage:"style_HomePage__39HyE",slogan:"style_slogan__3ESLi",ballGroup:"style_ballGroup__3Yrc5",ball:"style_ball__2mxKH",subTitle:"style_subTitle__1-Xg-",menu:"style_menu__2Jp3l",create:"style_create__2PDh_",form:"style_form__3edYN",rule:"style_rule__Cjqvv"}},7:function(e,t,a){e.exports={GamePage:"style_GamePage__3oB8L",winMap:"style_winMap__2EpiN",start:"style_start__3UEjd",way:"style_way__3TNYO",player:"style_player__1mIID",nameColor:"style_nameColor__haFkJ",end:"style_end__IFxsV",gap:"style_gap__3ZdYz",result:"style_result__3WXQ5",winList:"style_winList__OB6Xp",winnerIs:"style_winnerIs__8g5sy",buttons:"style_buttons__2R5Gl"}},71:function(e,t,a){},72:function(e,t,a){},79:function(e,t,a){}},[[133,1,2]]]);
//# sourceMappingURL=main.a739c15b.chunk.js.map